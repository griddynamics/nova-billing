Overview
===========================

The billing server stores instance state information (creation, stopping,
suspending, etc.) in a database and generates reports accessed by REST API.


Configuration
===========================

By default, the billing server uses ``/var/lib/nova/nova_billing.sqlite`` database 
(parameter ``billing_sql_connection``) and port 8787 (parameter ``billing_listen_port``)
that can be changed in ``/etc/nova/nova.conf``.

The server saves logs to ``/var/log/nova/nova-billing.log``.


RPM Building
===========================

Clone nova-billing git repository, rename the top dir to nova-billing-0.0.1,
and tar it to nova-billing-0.0.1.tar.gz. Place it to rpmbuild/SOURCES
directory and run::

    $ rpmbuild -ba nova-billing.spec


Quickstart
===========================

Install the package::

    # yum install nova-billing

Start the server::

    # /etc/init.d/nova-billing start

Now instance state changes will be stored to a database.

Try to run or terminate an instance and check that the daemon returns reports::

    $ curl http://localhost:8787/projects/systenant/2011 | python -mjson.tool


Its output should look like this::

    {
        "date": "2011-01-01T00:00:00Z", 
        "duration": "year", 
        "projects": {
            "systenant": {
                "instances_count": 2, 
                "name": "systenant", 
                "usage": {
                    "local_gb": 12,
                    "memory_mb": 45,
                    "vcpus": 39
                },
                "running": 257115, 
                "url": "http://127.0.0.1:8787/projects/systenant"
            }
        }
    }
